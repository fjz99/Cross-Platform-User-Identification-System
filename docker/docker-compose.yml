# yaml 配置
version: "3.4"
services:
  backend:
    build:
      #因为docker compose启动的时候，会设定yml的位置为相对路径
      context: ../
      dockerfile: ./docker/Dockerfile
    image: cpuis:1.0
    #生成image的名字
    ports:
      - "80:8899"
    tty: true
    stdin_open: true
    #同时配置2个，完成tty
    container_name: CPUIS
    # 默认名称
    depends_on:
      - mongo
    volumes: #支持E：/,不会解析错
      - /CpuisProduction/:/cpuis/
    environment:
      - JAVA_OPTS=-Xmx256M -Duser.timezone=GMT+08
  # 如果不配置network的话，就会创建一个默认的network
  mongo:
    image: mongo:4.4.0 #根据需要选择自己的镜像
    restart: always
    container_name: mongo
    ports:
      - "27017" #对外暴露停供服务的端口，正式生产的时候理论不用暴露。
    volumes:
      - /cpuis/mongodb/data/db:/data/db # 挂载数据目录
      - /cpuis/mongodb/data/log:/var/log/mongodb  # 挂载日志目录
      - /cpuis/mongodb/data/config:/etc/mongo  # 挂载配置目录
    # command: --config /docker/mongodb/mongod.conf # 配置文件
